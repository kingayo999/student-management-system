import{s as b,j as e,P as i,R as q,u as K}from"./index-B6BQ_5Jc.js";import{r as p}from"./vendor-react-DPUOiDZ6.js";import{u as Q,a as W}from"./useDebounce-XaSDqtCT.js";import{h as Y,a as Z}from"./errorHandler-CWQmkH48.js";import{l as C}from"./logger-CdRFjmXn.js";import{X as A,L,P as ee,m as te,n as P,o as se,p as re}from"./vendor-icons-DAIYLrmQ.js";import"./vendor-supabase-BZ0N5lZN.js";const ae=()=>{const[u,m]=p.useState([]),[f,t]=p.useState(!1),[d,a]=p.useState(null),h=p.useCallback(async()=>{t(!0),a(null);try{const{data:l,error:n}=await b.from("students").select(`
                    *,
                    profiles:user_id (full_name),
                    departments:department_id (name, code)
                `).is("deleted_at",null);if(n)throw n;m(l||[])}catch(l){a(Y(l,"fetch_students"))}finally{t(!1)}},[]);return{students:u,loading:f,error:d,fetchStudents:h,createStudent:async l=>{t(!0);try{const{data:n,error:x}=await b.from("students").insert([{...l,reg_no:l.reg_no.toUpperCase()}]).select().single();if(x)throw x.code==="23505"?new Error("Registration ID already exists in the mainframe."):x;return await C("create_student","students",n.id),await h(),{success:!0,data:n}}catch(n){return{success:!1,error:n.message}}finally{t(!1)}},updateStudent:async(l,n)=>{t(!0);try{const{error:x}=await b.from("students").update({...n,reg_no:n.reg_no?.toUpperCase()}).eq("id",l);if(x)throw x;return await C("update_student","students",l),await h(),{success:!0}}catch(x){return{success:!1,error:x.message}}finally{t(!1)}},deactivateStudent:async l=>{t(!0);try{const{error:n}=await b.from("students").update({deleted_at:new Date().toISOString(),status:"inactive"}).eq("id",l);if(n)throw n;return await C("deactivate_student","students",l),m(x=>x.filter(N=>N.id!==l)),{success:!0}}catch{return{success:!1,error:"Authorization failure: Could not deactivate record."}}finally{t(!1)}}}},M=({isOpen:u,onClose:m,onSubmit:f,studentData:t,onStudentDataChange:d,departments:a,availableProfiles:h,submitting:r})=>u?e.jsx("div",{className:"fixed inset-0 bg-primary-950/40 backdrop-blur-xl z-50 flex items-center justify-center p-6 animate-in fade-in duration-500",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden border border-white/20 animate-in zoom-in duration-500",children:[e.jsxs("div",{className:"p-8 sm:p-10 border-b border-primary-50 flex items-center justify-between bg-gradient-to-br from-primary-900 to-primary-950 text-white relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.05] bg-[radial-gradient(#fff_1px,transparent_1px)] [background-size:20px_20px]"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black tracking-tighter uppercase italic font-heading",children:"New Enrollment"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mt-1 lg:mt-1.5",children:"Administrative Protocol"})]}),e.jsx("button",{onClick:m,className:"text-white/50 hover:text-white transition-colors bg-white/5 p-2 sm:p-3 rounded-xl sm:rounded-2xl relative z-10",children:e.jsx(A,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-8 sm:p-10 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Registration Identifier"}),e.jsx("input",{required:!0,className:"input-field",placeholder:"e.g. 21/0001",value:t.reg_no,onChange:s=>d({...t,reg_no:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Department"}),e.jsxs("select",{required:!0,className:"input-field appearance-none bg-gray-50/50",value:t.department_id,onChange:s=>d({...t,department_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Departmental Node"}),a.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.code,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Academic Level"}),e.jsxs("select",{className:"input-field appearance-none bg-gray-50/50",value:t.level,onChange:s=>d({...t,level:s.target.value}),children:[e.jsx("option",{value:"100",children:"100 Level"}),e.jsx("option",{value:"200",children:"200 Level"}),e.jsx("option",{value:"300",children:"300 Level"}),e.jsx("option",{value:"400",children:"400 Level"}),e.jsx("option",{value:"500",children:"500 Level"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Profile Association UID"}),e.jsxs("select",{required:!0,className:"input-field appearance-none bg-gray-50/50",value:t.user_id,onChange:s=>d({...t,user_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Authorize Identity Link"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.full_name," (",s.email,")"]},s.id))]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-8 py-4 border border-gray-100 rounded-2xl text-[10px] font-black uppercase tracking-widest text-gray-400 hover:bg-gray-50 transition-all",children:"Abort"}),e.jsx("button",{type:"submit",disabled:r,className:"btn-primary flex-1",children:r?e.jsx(L,{className:"w-5 h-5 animate-spin"}):"Authorize Enrollment"})]})]})]})}):null;M.propTypes={isOpen:i.bool.isRequired,onClose:i.func.isRequired,onSubmit:i.func.isRequired,studentData:i.object.isRequired,onStudentDataChange:i.func.isRequired,departments:i.array.isRequired,availableProfiles:i.array.isRequired,submitting:i.bool};const T=({isOpen:u,onClose:m,onSubmit:f,studentData:t,onStudentDataChange:d,departments:a,submitting:h})=>!u||!t?null:e.jsx("div",{className:"fixed inset-0 bg-primary-950/40 backdrop-blur-xl z-50 flex items-center justify-center p-6 animate-in fade-in duration-500",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden border border-white/20 animate-in zoom-in duration-500",children:[e.jsxs("div",{className:"p-8 sm:p-10 border-b border-primary-50 flex items-center justify-between bg-primary-950 text-white relative",children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-gradient-to-r from-accent-500 to-transparent"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black tracking-tighter uppercase italic font-heading",children:"Modify Record"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mt-1 lg:mt-1.5",children:"Registry Authentication"})]}),e.jsx("button",{onClick:m,className:"text-white/50 hover:text-white transition-colors bg-white/5 p-2 sm:p-3 rounded-xl sm:rounded-2xl relative z-10",children:e.jsx(A,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-8 sm:p-10 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Registration Identifier"}),e.jsx("input",{required:!0,className:"input-field",value:t.reg_no,onChange:r=>d({...t,reg_no:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Department"}),e.jsx("select",{required:!0,className:"input-field appearance-none",value:t.department_id,onChange:r=>d({...t,department_id:r.target.value}),children:a.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.code,")"]},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Academic Level"}),e.jsxs("select",{className:"input-field appearance-none",value:t.level,onChange:r=>d({...t,level:r.target.value}),children:[e.jsx("option",{value:"100",children:"100 Level"}),e.jsx("option",{value:"200",children:"200 Level"}),e.jsx("option",{value:"300",children:"300 Level"}),e.jsx("option",{value:"400",children:"400 Level"}),e.jsx("option",{value:"500",children:"500 Level"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Administrative Status"}),e.jsxs("select",{className:"input-field appearance-none",value:t.status,onChange:r=>d({...t,status:r.target.value}),children:[e.jsx("option",{value:"active",children:"Active Protocol"}),e.jsx("option",{value:"inactive",children:"Inactive / Suspended"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-8 py-4 border border-gray-100 rounded-2xl text-[10px] font-black uppercase tracking-widest text-gray-400 hover:bg-gray-50 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",disabled:h,className:"btn-primary flex-1",children:h?e.jsx(L,{className:"w-5 h-5 animate-spin"}):"Commit Changes"})]})]})]})});T.propTypes={isOpen:i.bool.isRequired,onClose:i.func.isRequired,onSubmit:i.func.isRequired,studentData:i.object,onStudentDataChange:i.func.isRequired,departments:i.array.isRequired,submitting:i.bool};const D=({students:u,loading:m,profile:f,onEdit:t,onDelete:d})=>e.jsx("div",{className:"academic-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-primary-950 text-white uppercase tracking-[0.25em] text-[8px] sm:text-[9px] font-black whitespace-nowrap",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Reg Identifier"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Full Identity"}),e.jsx("th",{className:"hidden lg:table-cell px-4 sm:px-10 py-4 sm:py-7",children:"Department"}),e.jsx("th",{className:"hidden md:table-cell px-4 sm:px-10 py-4 sm:py-7",children:"Current Level"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Status"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-primary-50",children:m?[1,2,3,4,5].map(a=>e.jsx("tr",{className:"animate-pulse",children:e.jsx("td",{colSpan:"6",className:"px-10 py-8 bg-gray-50/20"})},a)):u.length>0?u.map(a=>e.jsxs("tr",{className:"hover:bg-primary-50/20 transition-all group duration-500 whitespace-nowrap",children:[e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsx("span",{className:"font-mono font-bold text-[10px] sm:text-xs text-primary-800 bg-primary-50 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl border border-primary-100 shadow-sm",children:a.reg_no})}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-primary-600 to-indigo-800 flex items-center justify-center text-white text-xs sm:text-lg font-black shadow-xl shadow-primary-900/20 group-hover:rotate-3 transition-transform",children:a.profiles?.full_name?.charAt(0)}),e.jsx("span",{className:"text-xs sm:text-sm font-black text-primary-950 uppercase tracking-tight",children:a.profiles?.full_name})]})}),e.jsx("td",{className:"hidden lg:table-cell px-4 sm:px-10 py-4 sm:py-8 text-[11px] sm:text-xs font-black text-primary-400 uppercase tracking-widest",children:a.departments?.name||"Departmental Node Mismatch"}),e.jsxs("td",{className:"hidden md:table-cell px-4 sm:px-10 py-4 sm:py-8 text-[10px] sm:text-[11px] font-black text-primary-700",children:[a.level," Level"]}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-2 sm:px-4 py-1.5 sm:py-2 rounded-full text-[8px] sm:text-[9px] font-black uppercase tracking-[0.2em] border ${a.status==="active"?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:[e.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${a.status==="active"?"bg-emerald-500 animate-pulse":"bg-amber-500"}`}),a.status]})}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 sm:gap-3 lg:opacity-0 group-hover:opacity-100 transition-all duration-500 translate-x-4 group-hover:translate-x-0",children:[e.jsx("button",{className:"p-2 sm:p-3 text-primary-700 hover:bg-white rounded-xl transition-all border border-transparent hover:border-primary-100 hover:shadow-xl active:scale-90",title:"Modify Protocol",onClick:()=>t(a),children:e.jsx(ee,{className:"w-4 h-4"})}),f?.role===q.ADMIN&&e.jsx("button",{className:"p-2 sm:p-3 text-red-500 hover:bg-white rounded-xl transition-all border border-transparent hover:border-red-100 hover:shadow-xl active:scale-90",title:"Revoke Access",onClick:()=>d(a.id),children:e.jsx(te,{className:"w-4 h-4"})})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-10 py-32 text-center",children:e.jsxs("div",{className:"max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-primary-50 w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-primary-100 shadow-inner",children:e.jsx(P,{className:"w-10 h-10 text-primary-200"})}),e.jsx("h3",{className:"text-primary-950 font-black text-xl mb-2 tracking-tight font-heading",children:"No Records Found"}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Coordinate your search parameters and try again."})]})})})})]})})});D.propTypes={students:i.array.isRequired,loading:i.bool.isRequired,profile:i.object,onEdit:i.func.isRequired,onDelete:i.func.isRequired};const pe=()=>{const{profile:u}=K(),{students:m,loading:f,fetchStudents:t,createStudent:d,updateStudent:a,deactivateStudent:h}=ae(),{feedback:r,showFeedback:s}=Q(),[w,l]=p.useState(!1),[n,x]=p.useState(""),[N,k]=p.useState(!1),[O,S]=p.useState(!1),[y,v]=p.useState(null),[E,F]=p.useState([]),[U,$]=p.useState([]),[g,z]=p.useState({reg_no:"",department_id:"",level:"100",user_id:""}),_=W(n,300),V=p.useMemo(()=>{if(!_)return m;const o=_.toLowerCase();return m.filter(c=>c.profiles?.full_name?.toLowerCase().includes(o)||c.reg_no?.toLowerCase().includes(o))},[m,_]);p.useEffect(()=>{t(),I()},[t]);const I=async()=>{try{const{data:o}=await b.from("departments").select("id, name, code").order("name");F(o||[]);const{data:c}=await b.from("students").select("user_id"),j=c?.map(J=>J.user_id)||[];let R=b.from("profiles").select("id, full_name, email").eq("role",q.STUDENT);j.length>0&&(R=R.not("id","in",`(${j.join(",")})`));const{data:H}=await R;$(H||[])}catch(o){console.error("Error fetching metadata:",o)}},B=async o=>{o.preventDefault(),l(!0);try{if(!g.user_id)throw new Error("Identity Authorization UID is mandatory.");if(!g.department_id)throw new Error("Departmental node must be selected.");const c=Z(g.reg_no);if(!c.isValid)throw new Error(c.message);const j=await d(g);j.success?(s("success",`Authorization success: ${g.reg_no} enrolled.`),k(!1),z({reg_no:"",department_id:"",level:"100",user_id:""}),I()):s("error",j.error)}catch(c){s("error",c.message)}finally{l(!1)}},G=async o=>{o.preventDefault(),l(!0);try{if(!y.reg_no)throw new Error("Registration Number is required");const c=await a(y.id,y);c.success?(s("success","Registry records synchronized successfully."),S(!1),v(null)):s("error",c.error)}catch(c){s("error",c.message)}finally{l(!1)}},X=async o=>{if(!window.confirm("Are you sure you want to deactivate this student record?"))return;const c=await h(o);c.success?s("success","Security Protocol: Record deactivated and archived."):s("error",c.error)};return e.jsxs("div",{className:"space-y-12 animate-slide-up",children:[r.message&&e.jsxs("div",{className:`fixed top-24 right-8 z-[60] p-5 rounded-2xl shadow-2xl border flex items-center gap-4 animate-in slide-in-from-right duration-500 backdrop-blur-xl ${r.type==="error"?"bg-red-50/90 border-red-100 text-red-800":"bg-emerald-50/90 border-emerald-100 text-emerald-800"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${r.type==="error"?"bg-red-100":"bg-emerald-100"}`,children:r.type==="error"?e.jsx(A,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5 animate-spin"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-50",children:r.type==="error"?"Security Breach":"Protocol Success"}),e.jsx("p",{className:"text-xs font-bold",children:r.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 sm:gap-8 pb-6 border-b border-primary-100/50",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-10 sm:w-12 h-1 bg-primary-600 rounded-full"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-500 uppercase tracking-[0.4em]",children:"Official Registry"})]}),e.jsxs("h1",{className:"text-4xl sm:text-5xl font-black text-primary-950 tracking-tighter italic font-heading",children:["Student ",e.jsx("span",{className:"text-primary-600",children:"Directory"})]})]}),u?.role===q.ADMIN&&e.jsxs("button",{onClick:()=>k(!0),className:"btn-primary group w-full md:w-auto",children:[e.jsx(se,{className:"w-4 h-4 group-hover:rotate-90 transition-transform duration-500"}),"Enroll New Student"]})]}),e.jsxs("div",{className:"academic-card p-2 sm:p-4 flex flex-col md:flex-row gap-3 sm:gap-4 items-center bg-white shadow-2xl shadow-primary-950/5",children:[e.jsxs("div",{className:"relative flex-1 group w-full",children:[e.jsx(P,{className:"absolute left-5 sm:left-6 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-300 transition-colors group-focus-within:text-primary-600"}),e.jsx("input",{type:"text",placeholder:"Search records by registration identifier or name...",className:"w-full pl-14 sm:pl-16 pr-6 sm:pr-8 py-4 sm:py-5 bg-transparent rounded-2xl focus:outline-none font-medium placeholder:text-gray-300 text-sm",value:n,onChange:o=>x(o.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 px-6 py-4 bg-primary-50 rounded-xl sm:rounded-2xl border border-primary-100/50 w-full sm:w-auto",children:[e.jsx(re,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-primary-900 uppercase tracking-widest",children:"Global Filter"})]})]}),e.jsx(D,{students:V,loading:f,profile:u,onEdit:o=>{v({...o}),S(!0)},onDelete:X}),e.jsx(M,{isOpen:N,onClose:()=>k(!1),onSubmit:B,studentData:g,onStudentDataChange:z,departments:E,availableProfiles:U,submitting:w}),e.jsx(T,{isOpen:O&&!!y,onClose:()=>{S(!1),v(null)},onSubmit:G,studentData:y,onStudentDataChange:v,departments:E,submitting:w})]})};export{pe as default};
