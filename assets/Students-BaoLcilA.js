import{u as B,s as d,j as e}from"./index-Dd6yNnWg.js";import{r as l}from"./vendor-react-D1YLald2.js";import{l as j}from"./logger-BCmI0uCF.js";import{X as w,g as N,P as G,m as z,n as K,o as W,p as X}from"./vendor-icons-BilFm2o-.js";import"./vendor-supabase-BZ0N5lZN.js";const Y=()=>{const{profile:k}=B(),[_,g]=l.useState([]),[D,E]=l.useState(!0),[x,u]=l.useState(!1),[b,I]=l.useState(""),[R,h]=l.useState(!1),[P,f]=l.useState(!1),[s,c]=l.useState(null),[y,q]=l.useState([]),[M,F]=l.useState([]),[o,S]=l.useState({type:"",message:""}),[r,m]=l.useState({reg_no:"",department_id:"",level:"100",user_id:""});l.useEffect(()=>{v(),C()},[]);const C=async()=>{try{const{data:t}=await d.from("departments").select("id, name, code").order("name");q(t||[]);const{data:a}=await d.from("students").select("user_id"),i=a?.map(O=>O.user_id)||[],{data:p}=await d.from("profiles").select("id, full_name, email").eq("role","student").not("id","in",`(${i.join(",")})`);F(p||[])}catch(t){console.error("Error fetching metadata:",t)}},v=async()=>{try{const{data:t,error:a}=await d.from("students").select(`
                    *,
                    profiles:user_id (full_name),
                    departments:department_id (name, code)
                `).is("deleted_at",null);if(a)throw a;g(t||[])}catch{n("error","Critical breach: Failed to synchronize student records.")}finally{E(!1)}},n=(t,a)=>{S({type:t,message:a}),setTimeout(()=>S({type:"",message:""}),5e3)},A=t=>{if(!t.reg_no.match(/^[A-Z0-9/\-]{5,20}$/i))throw new Error("Invalid Registration Identifier format protocol.");if(!t.user_id)throw new Error("Identity Authorization UID is mandatory.");if(!t.department_id)throw new Error("Departmental node must be selected.")},$=async t=>{t.preventDefault(),u(!0);try{A(r);const{data:a,error:i}=await d.from("students").insert([{reg_no:r.reg_no.toUpperCase(),department_id:r.department_id,level:r.level,user_id:r.user_id,college:y.find(p=>p.id===r.department_id)?.name||"UNKNOWN"}]).select().single();if(i)throw i.code==="23505"?new Error("Registration ID already exists in the mainframe."):i;await j("create_student","students",a.id),n("success",`Authorization success: ${r.reg_no} enrolled.`),h(!1),m({reg_no:"",department_id:"",level:"100",user_id:""}),v(),C()}catch(a){n("error",a.message)}finally{u(!1)}},U=async t=>{t.preventDefault(),u(!0);try{A(s);const{error:a}=await d.from("students").update({reg_no:s.reg_no.toUpperCase(),department_id:s.department_id,level:s.level,status:s.status}).eq("id",s.id);if(a)throw a;await j("update_student","students",s.id),n("success","Registry records synchronized successfully."),f(!1),c(null),v()}catch(a){n("error",a.message)}finally{u(!1)}},T=async t=>{if(!window.confirm("Are you sure you want to deactivate this student record?"))return;const a=[..._];g(i=>i.filter(p=>p.id!==t));try{const{error:i}=await d.from("students").update({deleted_at:new Date().toISOString(),status:"inactive"}).eq("id",t);if(i)throw i;await j("deactivate_student","students",t),n("success","Security Protocol: Record deactivated and archived.")}catch{g(a),n("error","Authorization failure: Could not deactivate record.")}},L=_.filter(t=>t.profiles?.full_name?.toLowerCase().includes(b.toLowerCase())||t.reg_no?.toLowerCase().includes(b.toLowerCase()));return e.jsxs("div",{className:"space-y-12 animate-slide-up",children:[o.message&&e.jsxs("div",{className:`fixed top-24 right-8 z-[60] p-5 rounded-2xl shadow-2xl border flex items-center gap-4 animate-in slide-in-from-right duration-500 backdrop-blur-xl ${o.type==="error"?"bg-red-50/90 border-red-100 text-red-800":"bg-emerald-50/90 border-emerald-100 text-emerald-800"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${o.type==="error"?"bg-red-100":"bg-emerald-100"}`,children:o.type==="error"?e.jsx(w,{className:"w-5 h-5"}):e.jsx(N,{className:"w-5 h-5 animate-spin"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-50",children:o.type==="error"?"Security Breach":"Protocol Success"}),e.jsx("p",{className:"text-xs font-bold",children:o.message})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 sm:gap-8 pb-6 border-b border-primary-100/50",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-10 sm:w-12 h-1 bg-primary-600 rounded-full"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-500 uppercase tracking-[0.4em]",children:"Official Registry"})]}),e.jsxs("h1",{className:"text-4xl sm:text-5xl font-black text-primary-950 tracking-tighter italic font-heading",children:["Student ",e.jsx("span",{className:"text-primary-600",children:"Directory"})]})]}),k?.role==="admin"&&e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary group w-full md:w-auto",children:[e.jsx(G,{className:"w-4 h-4 group-hover:rotate-90 transition-transform duration-500"}),"Enroll New Student"]})]}),e.jsxs("div",{className:"academic-card p-2 sm:p-4 flex flex-col md:flex-row gap-3 sm:gap-4 items-center bg-white shadow-2xl shadow-primary-950/5",children:[e.jsxs("div",{className:"relative flex-1 group w-full",children:[e.jsx(z,{className:"absolute left-5 sm:left-6 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-300 transition-colors group-focus-within:text-primary-600"}),e.jsx("input",{type:"text",placeholder:"Search records by registration identifier or name...",className:"w-full pl-14 sm:pl-16 pr-6 sm:pr-8 py-4 sm:py-5 bg-transparent rounded-2xl focus:outline-none font-medium placeholder:text-gray-300 text-sm",value:b,onChange:t=>I(t.target.value)})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 px-6 py-4 bg-primary-50 rounded-xl sm:rounded-2xl border border-primary-100/50 w-full sm:w-auto",children:[e.jsx(K,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-primary-900 uppercase tracking-widest",children:"Global Filter"})]})]}),e.jsx("div",{className:"academic-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-primary-950 text-white uppercase tracking-[0.25em] text-[8px] sm:text-[9px] font-black whitespace-nowrap",children:e.jsx("tr",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Reg Identifier"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Full Identity"}),e.jsx("th",{className:"hidden lg:table-cell px-4 sm:px-10 py-4 sm:py-7",children:"Department"}),e.jsx("th",{className:"hidden md:table-cell px-4 sm:px-10 py-4 sm:py-7",children:"Current Level"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7",children:"Status"}),e.jsx("th",{className:"px-4 sm:px-10 py-4 sm:py-7 text-right",children:"Actions"})]})})}),e.jsx("tbody",{className:"divide-y divide-primary-50",children:D?[1,2,3,4,5].map(t=>e.jsx("tr",{className:"animate-pulse",children:e.jsx("td",{colSpan:"6",className:"px-10 py-8 bg-gray-50/20"})},t)):L.length>0?L.map(t=>e.jsxs("tr",{className:"hover:bg-primary-50/20 transition-all group duration-500 whitespace-nowrap",children:[e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsx("span",{className:"font-mono font-bold text-[10px] sm:text-xs text-primary-800 bg-primary-50 px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl border border-primary-100 shadow-sm",children:t.reg_no})}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5",children:[e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-primary-600 to-indigo-800 flex items-center justify-center text-white text-xs sm:text-lg font-black shadow-xl shadow-primary-900/20 group-hover:rotate-3 transition-transform",children:t.profiles?.full_name?.charAt(0)}),e.jsx("span",{className:"text-xs sm:text-sm font-black text-primary-950 uppercase tracking-tight",children:t.profiles?.full_name})]})}),e.jsx("td",{className:"hidden lg:table-cell px-4 sm:px-10 py-4 sm:py-8 text-[11px] sm:text-xs font-black text-primary-400 uppercase tracking-widest",children:t.departments?.name||"Departmental Node Mismatch"}),e.jsxs("td",{className:"hidden md:table-cell px-4 sm:px-10 py-4 sm:py-8 text-[10px] sm:text-[11px] font-black text-primary-700",children:[t.level," Level"]}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-2 sm:px-4 py-1.5 sm:py-2 rounded-full text-[8px] sm:text-[9px] font-black uppercase tracking-[0.2em] border ${t.status==="active"?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:[e.jsx("span",{className:`w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full ${t.status==="active"?"bg-emerald-500 animate-pulse":"bg-amber-500"}`}),t.status]})}),e.jsx("td",{className:"px-4 sm:px-10 py-4 sm:py-8 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 sm:gap-3 lg:opacity-0 group-hover:opacity-100 transition-all duration-500 translate-x-4 group-hover:translate-x-0",children:[e.jsx("button",{className:"p-2 sm:p-3 text-primary-700 hover:bg-white rounded-xl transition-all border border-transparent hover:border-primary-100 hover:shadow-xl active:scale-90",title:"Modify Protocol",onClick:()=>{c({...t}),f(!0)},children:e.jsx(W,{className:"w-4 h-4"})}),k?.role==="admin"&&e.jsx("button",{className:"p-2 sm:p-3 text-red-500 hover:bg-white rounded-xl transition-all border border-transparent hover:border-red-100 hover:shadow-xl active:scale-90",title:"Revoke Access",onClick:()=>T(t.id),children:e.jsx(X,{className:"w-4 h-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-10 py-32 text-center",children:e.jsxs("div",{className:"max-w-xs mx-auto",children:[e.jsx("div",{className:"bg-primary-50 w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-primary-100 shadow-inner",children:e.jsx(z,{className:"w-10 h-10 text-primary-200"})}),e.jsx("h3",{className:"text-primary-950 font-black text-xl mb-2 tracking-tight font-heading",children:"No Records Found"}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Coordinate your search parameters and try again."})]})})})})]})})}),R&&e.jsx("div",{className:"fixed inset-0 bg-primary-950/40 backdrop-blur-xl z-50 flex items-center justify-center p-6 animate-in fade-in duration-500",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden border border-white/20 animate-in zoom-in duration-500",children:[e.jsxs("div",{className:"p-8 sm:p-10 border-b border-primary-50 flex items-center justify-between bg-gradient-to-br from-primary-900 to-primary-950 text-white relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.05] bg-[radial-gradient(#fff_1px,transparent_1px)] [background-size:20px_20px]"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black tracking-tighter uppercase italic font-heading",children:"New Enrollment"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mt-1 lg:mt-1.5",children:"Administrative Protocol"})]}),e.jsx("button",{onClick:()=>h(!1),className:"text-white/50 hover:text-white transition-colors bg-white/5 p-2 sm:p-3 rounded-xl sm:rounded-2xl relative z-10",children:e.jsx(w,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("form",{onSubmit:$,className:"p-8 sm:p-10 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Registration Identifier"}),e.jsx("input",{required:!0,className:"input-field",placeholder:"e.g. 21/0001",value:r.reg_no,onChange:t=>m({...r,reg_no:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Department"}),e.jsxs("select",{required:!0,className:"input-field appearance-none bg-gray-50/50",value:r.department_id,onChange:t=>m({...r,department_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Departmental Node"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Academic Level"}),e.jsxs("select",{className:"input-field appearance-none bg-gray-50/50",value:r.level,onChange:t=>m({...r,level:t.target.value}),children:[e.jsx("option",{value:"100",children:"100 Level"}),e.jsx("option",{value:"200",children:"200 Level"}),e.jsx("option",{value:"300",children:"300 Level"}),e.jsx("option",{value:"400",children:"400 Level"}),e.jsx("option",{value:"500",children:"500 Level"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Profile Association UID"}),e.jsxs("select",{required:!0,className:"input-field appearance-none bg-gray-50/50",value:r.user_id,onChange:t=>m({...r,user_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Authorize Identity Link"}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.full_name," (",t.email,")"]},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 px-8 py-4 border border-gray-100 rounded-2xl text-[10px] font-black uppercase tracking-widest text-gray-400 hover:bg-gray-50 transition-all",children:"Abort"}),e.jsx("button",{type:"submit",disabled:x,className:"btn-primary flex-1",children:x?e.jsx(N,{className:"w-5 h-5 animate-spin"}):"Authorize Enrollment"})]})]})]})}),P&&s&&e.jsx("div",{className:"fixed inset-0 bg-primary-950/40 backdrop-blur-xl z-50 flex items-center justify-center p-6 animate-in fade-in duration-500",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] shadow-2xl w-full max-w-lg overflow-hidden border border-white/20 animate-in zoom-in duration-500",children:[e.jsxs("div",{className:"p-8 sm:p-10 border-b border-primary-50 flex items-center justify-between bg-primary-950 text-white relative",children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1 bg-gradient-to-r from-accent-500 to-transparent"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black tracking-tighter uppercase italic font-heading",children:"Modify Record"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mt-1 lg:mt-1.5",children:"Registry Authentication"})]}),e.jsx("button",{onClick:()=>f(!1),className:"text-white/50 hover:text-white transition-colors bg-white/5 p-2 sm:p-3 rounded-xl sm:rounded-2xl relative z-10",children:e.jsx(w,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]}),e.jsxs("form",{onSubmit:U,className:"p-8 sm:p-10 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Registration Identifier"}),e.jsx("input",{required:!0,className:"input-field",value:s.reg_no,onChange:t=>c({...s,reg_no:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Department"}),e.jsx("select",{required:!0,className:"input-field appearance-none",value:s.department_id,onChange:t=>c({...s,department_id:t.target.value}),children:y.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.code,")"]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Academic Level"}),e.jsxs("select",{className:"input-field appearance-none",value:s.level,onChange:t=>c({...s,level:t.target.value}),children:[e.jsx("option",{value:"100",children:"100 Level"}),e.jsx("option",{value:"200",children:"200 Level"}),e.jsx("option",{value:"300",children:"300 Level"}),e.jsx("option",{value:"400",children:"400 Level"}),e.jsx("option",{value:"500",children:"500 Level"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-primary-400 uppercase tracking-[0.3em] mb-3 ml-1",children:"Administrative Status"}),e.jsxs("select",{className:"input-field appearance-none",value:s.status,onChange:t=>c({...s,status:t.target.value}),children:[e.jsx("option",{value:"active",children:"Active Protocol"}),e.jsx("option",{value:"inactive",children:"Inactive / Suspended"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>f(!1),className:"flex-1 px-8 py-4 border border-gray-100 rounded-2xl text-[10px] font-black uppercase tracking-widest text-gray-400 hover:bg-gray-50 transition-all",children:"Discard"}),e.jsx("button",{type:"submit",disabled:x,className:"btn-primary flex-1",children:x?e.jsx(N,{className:"w-5 h-5 animate-spin"}):"Commit Changes"})]})]})]})})]})};export{Y as default};
