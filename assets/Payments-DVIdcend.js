import{u as N,s as g,R as P,j as e}from"./index-g-fyFQge.js";import{r as n}from"./vendor-react-DPUOiDZ6.js";import{h as f}from"./errorHandler-CWQmkH48.js";import{E as S}from"./ErrorMessage-jorq_7RA.js";import{h as b,e as E,H as j,L as C,j as _,C as L}from"./vendor-icons-DAIYLrmQ.js";import"./vendor-supabase-BZ0N5lZN.js";const T=()=>{const{profile:m}=N(),[r,i]=n.useState(!1),[x,l]=n.useState(null),[y,o]=n.useState([]),d=n.useCallback(async()=>{i(!0),l(null);try{if(!m)return;let a=g.from("payments").select("*").order("created_at",{ascending:!1});m.role,P.STUDENT;const{data:c,error:s}=await a;if(s)throw s;o(c||[])}catch(a){console.error("Error fetching payments:",a),l(f(a,"fetch_payments"))}finally{i(!1)}},[m]);return{payments:y,loading:r,error:x,fetchPayments:d,recordPayment:async a=>{i(!0),l(null);try{const c=`PAY-${Date.now()}-${Math.floor(Math.random()*1e3)}`,{data:s,error:p}=await g.rpc("record_student_payment",{p_amount:parseFloat(a.amount),p_purpose:a.purpose,p_reference:c});if(p)throw p;if(!s.success)throw new Error(s.message);return await d(),s}catch(c){console.error("Error recording payment:",c);const s=f(c,"record_payment");throw l(s),new Error(s)}finally{i(!1)}}}},I=()=>{const{profile:m}=N(),{payments:r,loading:i,error:x,fetchPayments:l,recordPayment:y}=T(),[o,d]=n.useState("new"),[u,a]=n.useState(null),[c,s]=n.useState("");n.useEffect(()=>{l()},[l]);const p=async(t,h)=>{if(window.confirm(`Are you sure you want to pay ₦${h} for ${t}?`)){a(t),s("");try{await y({amount:h.replace(/,/g,""),purpose:t}),s(`Payment for ${t} was successful!`),d("history")}catch{}finally{a(null)}}},w=[{id:"tuition",name:"Tuition Fee",amount:"500,000.00"},{id:"medical",name:"Medical Fee",amount:"30,000.00"},{id:"hostel",name:"Hostel Fee",amount:"150,000.00"},{id:"convocation",name:"Convocation Fee",amount:"50,000.00"}],v=r.filter(t=>t.status==="successful").reduce((t,h)=>t+Number(h.amount),0),k=r.length>0?new Date(r[0].date||r[0].created_at).toLocaleDateString():"N/A";return e.jsxs("div",{className:"space-y-8 animate-slide-up",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 pb-4 border-b border-primary-100/50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-10 sm:w-12 h-1 bg-accent-500 rounded-full"}),e.jsx("p",{className:"text-[9px] sm:text-[10px] font-black text-primary-500 uppercase tracking-[0.4em]",children:"Bursary Portal"})]}),e.jsx("h1",{className:"text-3xl sm:text-5xl font-black text-primary-950 tracking-tighter italic font-heading",children:"Payments"})]})}),x&&e.jsx(S,{message:x}),c&&e.jsxs("div",{className:"bg-emerald-50 text-emerald-700 p-4 rounded-xl flex items-center gap-3 border border-emerald-100",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-sm",children:c})]}),e.jsxs("div",{className:"flex gap-4 p-1 bg-primary-100/50 rounded-[1.25rem] w-fit",children:[e.jsxs("button",{onClick:()=>d("new"),className:`px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] transition-all flex items-center gap-2 ${o==="new"?"bg-white text-primary-950 shadow-lg":"text-primary-500 hover:text-primary-700"}`,children:[e.jsx(E,{className:"w-4 h-4"}),"Make New Payment"]}),e.jsxs("button",{onClick:()=>d("history"),className:`px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] transition-all flex items-center gap-2 ${o==="history"?"bg-white text-primary-950 shadow-lg":"text-primary-500 hover:text-primary-700"}`,children:[e.jsx(j,{className:"w-4 h-4"}),"Payment History"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[o==="new"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:col-span-2 academic-card p-8 sm:p-10 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-primary-950 uppercase tracking-tight mb-2",children:"Initiate Transaction"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select a payment category to proceed with your transaction securely via Paystack."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(t=>e.jsxs("button",{onClick:()=>p(t.name,t.amount),disabled:!!u,className:"p-6 rounded-2xl border border-gray-100 bg-gray-50 hover:bg-white hover:border-primary-200 hover:shadow-xl transition-all text-left group disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center mb-4 shadow-sm group-hover:bg-primary-50 transition-colors",children:u===t.name?e.jsx(C,{className:"w-5 h-5 text-accent-500 animate-spin"}):e.jsx(_,{className:"w-5 h-5 text-primary-400 group-hover:text-primary-600"})}),e.jsx("p",{className:"font-bold text-primary-950 mb-1",children:t.name}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Select to Pay"}),e.jsxs("p",{className:"text-sm font-black text-primary-950",children:["₦",t.amount]})]})]},t.id))})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-primary-950 rounded-[2rem] p-8 text-white relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-accent-500/10 rounded-full blur-3xl"}),e.jsx("h3",{className:"text-lg font-black uppercase tracking-widest mb-6 relative z-10",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center py-4 border-b border-white/10",children:[e.jsx("span",{className:"text-xs font-bold text-primary-300",children:"Total Paid"}),e.jsxs("span",{className:"text-xl font-black",children:["₦ ",v.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center py-4 border-b border-white/10",children:[e.jsx("span",{className:"text-xs font-bold text-primary-300",children:"Last Payment"}),e.jsx("span",{className:"text-sm font-bold",children:k})]})]}),e.jsx("button",{className:"w-full mt-8 py-4 bg-accent-500 text-primary-950 rounded-xl font-black uppercase tracking-widest text-[10px] hover:bg-white transition-all shadow-lg active:scale-95",children:"View Statement"})]})})]}),o==="history"&&e.jsx("div",{className:"lg:col-span-3 academic-card p-0 overflow-hidden",children:i&&r.length===0?e.jsx("div",{className:"p-12 text-center text-gray-400 text-sm",children:"Loading payment history..."}):r.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(j,{className:"w-12 h-12 text-gray-200 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"No payment history found."})]}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-primary-50 text-primary-950 uppercase tracking-widest text-[9px] font-black",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-8 py-6",children:"Reference"}),e.jsx("th",{className:"px-8 py-6",children:"Purpose"}),e.jsx("th",{className:"px-8 py-6",children:"Date"}),e.jsx("th",{className:"px-8 py-6",children:"Amount (NGN)"}),e.jsx("th",{className:"px-8 py-6 text-right",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-8 py-6 font-mono text-xs font-bold text-gray-500",children:t.reference}),e.jsx("td",{className:"px-8 py-6 font-bold text-primary-950",children:t.purpose}),e.jsx("td",{className:"px-8 py-6 text-sm text-gray-600",children:new Date(t.payment_date||t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-8 py-6 font-mono text-sm font-black text-primary-950",children:Number(t.amount).toLocaleString(void 0,{minimumFractionDigits:2})}),e.jsx("td",{className:"px-8 py-6 text-right",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest ${t.status==="successful"?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"}`,children:[t.status==="successful"?e.jsx(b,{className:"w-3 h-3"}):e.jsx(L,{className:"w-3 h-3"}),t.status]})})]},t.id))})]})})]})]})};export{I as default};
